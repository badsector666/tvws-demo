<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>TradingView WebSocket Example - tvws</title>
        <link rel="stylesheet" href="./main.css" />
    </head>
    <body>
        <div class="container">
            <!-- Header -->
            <div class="header">
                <h1>üöÄ TradingView WebSocket Example</h1>
                <p>
                    Test the <strong>tvws</strong> package with different
                    endpoints, authentication options, and data queries.
                </p>
            </div>

            <!-- Status Alerts -->
            <div id="status" class="alert info" style="display: none"></div>
            <div id="success" class="alert success" style="display: none"></div>
            <div id="error" class="alert error" style="display: none"></div>
            <div id="info" class="alert info" style="display: none"></div>
            <div id="warning" class="alert warning" style="display: none"></div>

            <!-- Endpoint Selection -->
            <div class="section-card endpoint-selector">
                <h3>üì° WebSocket Endpoint</h3>
                <div class="form-group">
                    <label for="endpointSelect" class="form-label"
                        >Select Endpoint:</label
                    >
                    <select id="endpointSelect" class="form-control">
                        <option value="data">data (recommended)</option>
                        <option value="prodata">prodata (premium)</option>
                        <option value="widgetdata">widgetdata</option>
                        <option value="charts-polygon">charts-polygon</option>
                    </select>
                </div>
            </div>

            <!-- Authentication & Controls - Two Column Layout -->
            <div class="two-column-layout">
                <!-- Authentication Section -->
                <div class="section-card auth-section compact">
                    <h3>üîê Authentication (Optional)</h3>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input
                                type="checkbox"
                                id="authToggle"
                                onchange="toggleAuthFields()"
                            />
                            <label for="authToggle"
                                >Enable Authentication</label
                            >
                        </div>
                    </div>
                    <div id="authFields" style="display: none">
                        <div class="form-group">
                            <label for="sessionId" class="form-label"
                                >Session ID:</label
                            >
                            <input
                                type="text"
                                id="sessionId"
                                class="form-control"
                                placeholder="e.g. qsxh1x2yz9i4x8x2..."
                            />
                        </div>
                        <div class="form-group">
                            <button
                                type="button"
                                class="btn btn-outline"
                                onclick="showSessionHelp()"
                            >
                                ‚ùì Help
                            </button>
                        </div>
                    </div>
                    <div
                        id="sessionHelp"
                        class="session-help"
                        style="display: none"
                    >
                        <h4>How to get Session ID:</h4>
                        <ol>
                            <li>
                                <a
                                    href="https://www.tradingview.com/chart/?symbol=BINANCE%3ABTCUSDT"
                                    target="_blank"
                                    >Open TradingView</a
                                >
                            </li>
                            <li>Open browser dev tools (F12)</li>
                            <li>
                                Go to Application tab ‚Üí Cookies ‚Üí
                                tradingview.com
                            </li>
                            <li>Find 'sessionid' cookie value</li>
                            <li>Copy the entire value (it's long!)</li>
                            <li>Paste in the session field above</li>
                        </ol>
                        <button
                            type="button"
                            class="btn btn-secondary"
                            onclick="hideSessionHelp()"
                        >
                            Close Help
                        </button>
                    </div>
                    <div id="authStatus" class="auth-status"></div>
                </div>

                <!-- Control Buttons -->
                <div class="section-card controls-section compact">
                    <h3>‚ö° Connection Controls</h3>
                    <div class="button-group">
                        <button
                            id="quickConnectBtn"
                            class="btn btn-success"
                            onclick="quickConnect()"
                        >
                            üöÄ Quick Connect
                        </button>
                        <button
                            id="connectBtn"
                            class="btn btn-primary"
                            onclick="testConnection()"
                        >
                            üîó Connect to TradingView
                        </button>
                        <button
                            id="clearBtn"
                            class="btn btn-secondary"
                            onclick="clearResults()"
                        >
                            üóëÔ∏è Clear Results
                        </button>
                        <button
                            id="clearLogBtn"
                            class="btn btn-secondary"
                            onclick="clearLog()"
                        >
                            üìã Clear Log
                        </button>
                    </div>
                </div>
            </div>

            <!-- K-Line Query Configuration -->
            <div class="section-card query-section">
                <h3>üìä K-Line Query Configuration</h3>

                <div class="form-group">
                    <label for="symbolsTextarea" class="form-label"
                        >Symbols (one per line):</label
                    >
                    <textarea
                        id="symbolsTextarea"
                        class="form-control"
                        rows="6"
                        placeholder="Enter symbols, one per line...&#10;Examples:&#10;BINANCE:BTCUSDT.P&#10;FX:EURUSD&#10;NASDAQ:AAPL&#10;CRYPTO:ETHUSD&#10;FX:GBPUSD&#10;NYSE:TSLA"
                    >
FX:EURUSD</textarea
                    >
                    <small class="form-help">
                        Enter multiple symbols, one per line. Supports crypto,
                        forex, stocks, etc.
                    </small>
                </div>

                <div class="form-group">
                    <label class="form-label">Timeframes & Amounts:</label>
                    <div class="timeframe-grid">
                        <div class="timeframe-item">
                            <input
                                type="checkbox"
                                id="tf_1m"
                                value="1m"
                                checked
                            />
                            <label for="tf_1m">1m</label>
                            <input
                                type="number"
                                class="timeframe-amount"
                                data-timeframe="1m"
                                value="1000"
                                min="1"
                                max="5000"
                                title="Number of candles for 1m"
                            />
                        </div>
                        <div class="timeframe-item">
                            <input type="checkbox" id="tf_3m" value="3m" />
                            <label for="tf_3m">3m</label>
                            <input
                                type="number"
                                class="timeframe-amount"
                                data-timeframe="3m"
                                value="1000"
                                min="1"
                                max="5000"
                                title="Number of candles for 3m"
                            />
                        </div>
                        <div class="timeframe-item">
                            <input type="checkbox" id="tf_5m" value="5m" />
                            <label for="tf_5m">5m</label>
                            <input
                                type="number"
                                class="timeframe-amount"
                                data-timeframe="5m"
                                value="1000"
                                min="1"
                                max="5000"
                                title="Number of candles for 5m"
                            />
                        </div>
                        <div class="timeframe-item">
                            <input type="checkbox" id="tf_15m" value="15m" />
                            <label for="tf_15m">15m</label>
                            <input
                                type="number"
                                class="timeframe-amount"
                                data-timeframe="15m"
                                value="500"
                                min="1"
                                max="5000"
                                title="Number of candles for 15m"
                            />
                        </div>
                        <div class="timeframe-item">
                            <input type="checkbox" id="tf_30m" value="30m" />
                            <label for="tf_30m">30m</label>
                            <input
                                type="number"
                                class="timeframe-amount"
                                data-timeframe="30m"
                                value="500"
                                min="1"
                                max="5000"
                                title="Number of candles for 30m"
                            />
                        </div>
                        <div class="timeframe-item">
                            <input type="checkbox" id="tf_45m" value="45m" />
                            <label for="tf_45m">45m</label>
                            <input
                                type="number"
                                class="timeframe-amount"
                                data-timeframe="45m"
                                value="500"
                                min="1"
                                max="5000"
                                title="Number of candles for 45m"
                            />
                        </div>
                        <div class="timeframe-item">
                            <input type="checkbox" id="tf_1h" value="1h" />
                            <label for="tf_1h">1h</label>
                            <input
                                type="number"
                                class="timeframe-amount"
                                data-timeframe="1h"
                                value="200"
                                min="1"
                                max="5000"
                                title="Number of candles for 1h"
                            />
                        </div>
                        <div class="timeframe-item">
                            <input type="checkbox" id="tf_2h" value="2h" />
                            <label for="tf_2h">2h</label>
                            <input
                                type="number"
                                class="timeframe-amount"
                                data-timeframe="2h"
                                value="200"
                                min="1"
                                max="5000"
                                title="Number of candles for 2h"
                            />
                        </div>
                        <div class="timeframe-item">
                            <input type="checkbox" id="tf_3h" value="3h" />
                            <label for="tf_3h">3h</label>
                            <input
                                type="number"
                                class="timeframe-amount"
                                data-timeframe="3h"
                                value="150"
                                min="1"
                                max="5000"
                                title="Number of candles for 3h"
                            />
                        </div>
                        <div class="timeframe-item">
                            <input type="checkbox" id="tf_4h" value="4h" />
                            <label for="tf_4h">4h</label>
                            <input
                                type="number"
                                class="timeframe-amount"
                                data-timeframe="4h"
                                value="150"
                                min="1"
                                max="5000"
                                title="Number of candles for 4h"
                            />
                        </div>
                        <div class="timeframe-item">
                            <input
                                type="checkbox"
                                id="tf_1D"
                                value="1D"
                                checked
                            />
                            <label for="tf_1D">1D</label>
                            <input
                                type="number"
                                class="timeframe-amount"
                                data-timeframe="1D"
                                value="30"
                                min="1"
                                max="5000"
                                title="Number of candles for 1D"
                            />
                        </div>
                        <div class="timeframe-item">
                            <input type="checkbox" id="tf_1W" value="1W" />
                            <label for="tf_1W">1W</label>
                            <input
                                type="number"
                                class="timeframe-amount"
                                data-timeframe="1W"
                                value="52"
                                min="1"
                                max="5000"
                                title="Number of candles for 1W"
                            />
                        </div>
                        <div class="timeframe-item">
                            <input type="checkbox" id="tf_1M" value="1M" />
                            <label for="tf_1M">1M</label>
                            <input
                                type="number"
                                class="timeframe-amount"
                                data-timeframe="1M"
                                value="24"
                                min="1"
                                max="5000"
                                title="Number of candles for 1M"
                            />
                        </div>
                    </div>
                    <small class="form-help">
                        Select multiple timeframes and set custom candle amounts
                        for each. Default values are optimized per timeframe.
                    </small>
                </div>

                <div class="button-group">
                    <button
                        id="candlesBtn"
                        class="btn btn-primary"
                        onclick="loadData()"
                        disabled
                    >
                        üìä Get K-Line Data
                    </button>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div
                id="performanceMetrics"
                class="section-card performance-section"
                style="display: none"
            >
                <h3>üìä Performance Metrics</h3>
                <div id="performanceSummary" class="performance-summary"></div>
                <div id="performanceDetails" class="performance-details"></div>
            </div>

            <!-- Results & Debug Log - Two Column Layout -->
            <div class="two-column-layout">
                <!-- Results Display -->
                <div
                    id="results"
                    class="results-container compact"
                    style="display: none"
                >
                    <h3 id="resultsTitle">üìà K-Line Data Results</h3>
                    <div id="queryInfo" class="query-info"></div>
                    <div id="candleData" class="candle-list"></div>
                </div>

                <!-- Debug Log -->
                <div class="debug-log compact">
                    <h3>üìã Debug Log</h3>
                    <div class="debug-controls">
                        <div class="control-group">
                            <label for="logLevelSelect">Log Level:</label>
                            <select
                                id="logLevelSelect"
                                onchange="setLogLevel()"
                            >
                                <option value="trace">Trace (All)</option>
                                <option value="debug">Debug</option>
                                <option value="info" selected>Info</option>
                                <option value="warn">Warning</option>
                                <option value="error">Error</option>
                                <option value="fatal">Fatal Only</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <button
                                id="realtimeToggleBtn"
                                class="btn btn-outline"
                                onclick="toggleRealtimeLogging()"
                                disabled
                            >
                                ‚ñ∂Ô∏è Enable Real-time Events
                            </button>
                        </div>
                        <div class="control-group">
                            <button
                                class="btn btn-outline"
                                onclick="clearLog()"
                            >
                                üóëÔ∏è Clear Log
                            </button>
                        </div>
                    </div>
                    <div id="log" class="log-container"></div>
                </div>
            </div>
        </div>

        <script type="module" src="./script.js"></script>
    </body>
</html>
